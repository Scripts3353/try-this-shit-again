<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Panel</title>
<style>
body { background: #10001a; color: white; font-family: Arial; display: flex; flex-direction: column; align-items: center; padding: 40px; }
#login-box, #admin-panel { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; width: 100%; max-width: 500px; margin-bottom: 20px; }
input { padding: 8px; border-radius: 5px; border: none; margin: 5px; width: calc(100% - 18px); }
button { background: #7e22ce; border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-top:5px;}
button:hover { background: #a855f7; }
.device { margin: 8px 0; padding: 8px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
.device.active { background: rgba(0,255,0,0.15);}
.device.revoked { background: rgba(255,0,0,0.2);}
</style>
</head>
<body>
<h2>Admin Login</h2>

<div id="login-box">
  <input type="text" id="user" placeholder="Username" /><br />
  <input type="password" id="pass" placeholder="Password" /><br />
  <button onclick="adminLogin()">Login</button>
</div>

<div id="admin-panel" style="display:none;">
  <h2>Device Manager</h2>
  <div id="device-list"></div>
  <button onclick="logout()">Logout</button>
</div>

<script>
const ADMIN_USER = "lukas";
const ADMIN_PASS = "lukas";
const REVOKED_KEY = "revokedDevices";

function adminLogin() {
  const user = document.getElementById("user").value.trim();
  const pass = document.getElementById("pass").value.trim();
  if (user === ADMIN_USER && pass === ADMIN_PASS) {
    document.getElementById("login-box").style.display = "none";
    document.getElementById("admin-panel").style.display = "block";
    loadDevices();
  } else alert("Invalid login");
}

function logout() {
  document.getElementById("admin-panel").style.display = "none";
  document.getElementById("login-box").style.display = "block";
}

function loadDevices() {
  const revoked = JSON.parse(localStorage.getItem(REVOKED_KEY) || "[]");
  const allDevices = JSON.parse(localStorage.getItem("allDevices") || "[]");
  const list = document.getElementById("device-list");
  list.innerHTML = "";
  if (allDevices.length === 0) { list.innerHTML = "<p>No devices generated yet.</p>"; return; }
  
  allDevices.forEach(id => {
    const div = document.createElement("div");
    div.className = "device " + (revoked.includes(id) ? "revoked" : "active");
    div.innerHTML = `<span>${id}</span> <button onclick="toggleRevoke('${id}')">${revoked.includes(id) ? "Unrevoke" : "Revoke"}</button>`;
    list.appendChild(div);
  });
}

function toggleRevoke(id) {
  let revoked = JSON.parse(localStorage.getItem(REVOKED_KEY) || "[]");
  if (revoked.includes(id)) revoked = revoked.filter(d => d !== id);
  else revoked.push(id);
  localStorage.setItem(REVOKED_KEY, JSON.stringify(revoked));
  loadDevices();
}
</script>
</body>
</html>
