<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checking Device Access</title>
<style>
body {
    background: #181028;
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
h2 {
    color: #a855f7;
}
</style>
</head>
<body>
<h2>Checking your device...</h2>

<script>
// Define keys
const DEVICE_KEY = "deviceLogin";
const REVOKED_KEY = "revokedDevices";

// Load revoked list
let revokedList = JSON.parse(localStorage.getItem(REVOKED_KEY) || "[]");

// Load existing device
let deviceData = JSON.parse(localStorage.getItem(DEVICE_KEY) || "null");

// If device doesn't exist, create a new one ONCE
if (!deviceData) {
    const newId = "dev-" + Math.random().toString(36).substring(2, 10);
    deviceData = { id: newId, createdAt: Date.now() };
    localStorage.setItem(DEVICE_KEY, JSON.stringify(deviceData));
}

// --- NEW FIX ---
// Prevent replacing ID if revoked
if (revokedList.includes(deviceData.id)) {
    document.body.innerHTML = `<h2 style="color:red;">Your Access Has Been Revoked</h2>`;
} else {
    // Continue to site.html if valid
    window.location.href = "site.html";
}
</script>

</body>
</html>
