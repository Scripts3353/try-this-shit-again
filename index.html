<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login</title>
<style>
body { margin:0; font-family:Arial; background: linear-gradient(135deg,#6a0dad,#3c0f5f); color:#fff; height:100vh; display:flex; align-items:center; justify-content:center; }
.box { background:rgba(0,0,0,0.9); padding:28px; border-radius:12px; width:360px; text-align:center; }
.small { font-size:13px; margin-top:10px; color:#ddd; white-space:pre-wrap; }
.btn { margin-top:14px; padding:10px 14px; border-radius:8px; border:none; background:#9d4edd; color:white; font-weight:700; cursor:pointer;}
.btn:hover { background:#ffcc00; color:#000; }
</style>
</head>
<body>
  <div class="box">
    <h2>Welcome to ReallyUnb0ck3d</h2>
    <div id="msg" class="small">Checking your device...</div>
    <button id="show" class="btn" style="display:none">Show credentials</button>
  </div>

<script>
(function(){
  const localKey = 'deviceLogin';
  const revokeKey = 'revokedDevices';
  const publicKey = 'publicDevices';

// Load device and revoked list
let loginData = localStorage.getItem(localKey);
const revoked = JSON.parse(localStorage.getItem(revokeKey) || '[]');

// Block revoked devices from generating new ID
if (loginData) {
    loginData = JSON.parse(loginData);
    if (revoked.includes(loginData.deviceId)) {
        document.body.innerHTML = '<h2 style="color:white;text-align:center;margin-top:50px;">Access revoked. Contact admin to reinstate.</h2>';
        throw new Error('Device revoked'); // stops further execution
    }
}
  const msg = document.getElementById('msg');
  const showBtn = document.getElementById('show');

  // check if device exists
  let loginData = localStorage.getItem(localKey);
  if (loginData) {
    loginData = JSON.parse(loginData);

    // check if revoked
    const revokedRaw = localStorage.getItem(revokeKey) || '[]';
    const revoked = JSON.parse(revokedRaw);
    if (revoked.includes(loginData.deviceId)) {
      msg.textContent = 'Your device is currently revoked. You cannot log in until it is reinstated.';
      return; // stop redirecting / generating new device
    }

    // device is valid -> redirect
    window.location.replace('site.html');
    return;
  }

  // generate new device
  const deviceId = 'dev-' + Math.random().toString(36).slice(2,10);
  const username = 'u_' + Math.random().toString(36).slice(2,8);
  const password = Math.random().toString(36).slice(2,10);
  const createdAt = new Date().toISOString();

  loginData = { deviceId, username, password, createdAt };
  localStorage.setItem(localKey, JSON.stringify(loginData));

  // append to publicDevices
  try {
    const raw = localStorage.getItem(publicKey);
    const list = raw ? JSON.parse(raw) : [];
    list.push(loginData);
    localStorage.setItem(publicKey, JSON.stringify(list));
  } catch(e) { console.error(e); }

  msg.textContent = `Your login has been created!\nUsername: ${username}\nPassword: ${password}\nDevice ID: ${deviceId}`;

  showBtn.style.display = 'inline-block';
  showBtn.onclick = () => alert(msg.textContent);

  setTimeout(()=> window.location.replace('site.html'), 900);
})();
</script>
</body>
</html>
